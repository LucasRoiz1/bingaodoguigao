<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Bingão do Guigão</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    .cartela-tabela {
      border-collapse: collapse;
      margin: 0 auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
    }

    .cartela-tabela td {
      width: 160px;
      height: 160px;
      font-size: 14px;
      padding: 10px;
      text-align: center;
      vertical-align: middle;
      border: 1px solid #ccc;
      background-color: white;
      transition: background 0.3s, transform 0.2s;
      cursor: pointer;
    }

    .cartela-tabela td:hover {
      background: #e0f7fa;
      transform: scale(1.02);
    }

    .cartela-tabela td.marcado {
      background: #26a69a !important;
      color: white;
      font-weight: bold;
    }

    footer {
      position: relative;
      text-align: center;
      width: 100%;
      margin-top: 40px;
    }
  </style>
</head>
<body class="bg-light d-flex flex-column justify-content-center align-items-center min-vh-100 text-center">

  <div class="container">
    <h1 class="mb-2">Bingão do Guigão</h1>
    <h5 id="nick-display" class="text-muted mb-4"></h5>
    <div id="cartela-container" class="mb-3"></div>
    <button id="limpar-btn" class="btn btn-outline-danger d-none">Limpar Marcações</button>
  </div>

  <!-- Áudios -->
  <audio id="audio-select" src="https://assets.mixkit.co/sfx/preview/mixkit-game-click-1114.mp3"></audio>
  <audio id="audio-unselect" src="https://assets.mixkit.co/sfx/preview/mixkit-player-losing-or-failing-2042.mp3"></audio>
  <audio id="audio-clear" src="https://assets.mixkit.co/sfx/preview/mixkit-arcade-retro-changing-tab-206.mp3"></audio>

  <footer class="text-muted mt-5">
    <small>Versão v0.6.0.0 – Última atualização: 07/05/2025</small>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const eventosValorant = [
      "Comprar uma Sheriff no terceiro round",
      "Comprar Operator no quinto round",
      "Dropar arma para um teammate no 9 round",
      "Comprar Phantom e fazer 3K",
      "Comprar Judge em round forçado",
      "Comprar Guardian e levar um entry kill",
      "Comprar Odin na defesa",
      "Fazer uma half-buy e vencer o round",
      "O half virar 8x4",
      "Empatar em 12x12 e ir para prorrogação",
      "Fechar o half com 9 rounds vencidos",
      "Perder round com spike plantada",
      "Fazer first kill no primeiro round",
      "Ser o primeiro a morrer no quinto round",
      "Fazer fake plant para baitar",
      "Plantar no meio da smoke",
      "Ser MVP da partida",
      "Terminar com mais mortes que kills",
      "Ganhar partida sem dar nenhum ACE",
      "Comprar Spectre em round bônus e fazer 3K",
      "Fazer uma compra full no round de eco inimigo e perder",
      "Ficar com 400 créditos após comprar tudo",
      "Forçar no segundo round após plantar spike no pistol",
      "Matar um inimigo enquanto cego",
      "Tomar kill atravessando smoke",
      "Dar um HS de Marshal",
      "Tomar kill ao olhar minimapa",
      "Morrer para Classic",
      "Morrer para sheriff",
      "Tomar kill durante o dash de Jett",
      "Matar um inimigo plantando spike",
      "Esquecer spike na base",
      "O half virar 7x5",
      "O half virar 6x6",
      "Comprar Vandal e fazer 3K",
      "Ficar com 200 créditos após comprar tudo",
      "Morrer para Operator",
      "Morrer para vandal",
      "Morrer para Ghost",
      "Matar 2 no round com Outlaw",
      "Tomar firstkill no primeiro round",
      "Tomar firstkill no sétimo round",
      "Tomar firstkill no quinto round",
      "Pegar a firstkill no quinto round",
      "Pegar a firstkill no quarto round",
      "Pegar a firstkill no oitavo round",
      "Morrer com a faca na mão",
      "Morrer para o lurker inimigo",
      "Matar 3 no round com operator",
      "Um amigo do time desconectar da partida",
      "Ganhar uma partida de 13x5",
      "Ganhar uma partida de 13x10",
      "Perder uma partida de 13x5",
      "Perder uma partida de 13x11",
      "Perder uma partida de 13x9",
      "Morrer enquanto eu estou ultando de neon",
      "Falar que meu time é ruim demais",
      "Pedir skin de algum amigo do time",
      "Ser spotado pela torreta da killjoy",
      "Bater em algum fio do cypher",
      "Instalockar neon",
      "Morrer para algum inimigo de Escopeta",
      "Puxar vandal e não dar 1 tiro no round",
      "Puxar operator e morrer sem matar ninguem",
      "Fazer sheriff + colete",
      "Pegar uma vandal no chão",
      "Matar um inimigo com 4 tiros no peito de vandal",
      "Coletar uma orb de ult",
      "Matar um e morrer para o segundo.",
      "Perder uma situação de 1x1",
      "Perder uma situação de 1x2",
      "Ganhar uma situação de 1x1",
      "Ganhar um clutch 1x2",
      "Matar quatro em um round",
      "Time inimigo fazer um ace",
      "Alguem do meu time fazer um ace",
      "Fazer alguma call de fake",
      "Morrer lurkeando",
      "Ser o último a morrer do time",
      "Tomar um 5x0 no placar",
      "Tomar um 7x1 no placar",
      "Fazer um 7x1 no placar",
      "Sair para ir no banheiro",
      "Utilizar algum recurso em mim mesmo",
      "Tomar algum spot do sova",
      "Tomar uma bang do omen",
      "Tomar algum tipo de stun",
      "Marcar costas e ninguém vir por lá",
      "Ganhar um round sem plantar a spike",
      "O time esquecer a spike na base"
    ];

    function getURLParam(param) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(param);
    }

    function hashToSeed(str) {
      let h = 0;
      for (let i = 0; i < str.length; i++) {
        h = Math.imul(31, h) + str.charCodeAt(i) | 0;
      }
      return h >>> 0;
    }

    function mulberry32(a) {
      return function() {
        let t = a += 0x6D2B79F5;
        t = Math.imul(t ^ t >>> 15, t | 1);
        t ^= t + Math.imul(t ^ t >>> 7, t | 61);
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      };
    }

    function gerarCartela(seed) {
      const rand = mulberry32(seed);
      const eventos = [...eventosValorant];

      // Embaralha eventos
      for (let i = eventos.length - 1; i > 0; i--) {
        const j = Math.floor(rand() * (i + 1));
        [eventos[i], eventos[j]] = [eventos[j], eventos[i]];
      }

      const selecionados = eventos.slice(0, 20);
      const linhas = [];
      for (let i = 0; i < 4; i++) {
        linhas.push(selecionados.slice(i * 5, i * 5 + 5));
      }

      return linhas;
    }

    function salvarMarcacoes(nick, eventos) {
      sessionStorage.setItem(`marcados_${nick}`, JSON.stringify(eventos));
    }

    function carregarMarcacoes(nick) {
      const data = sessionStorage.getItem(`marcados_${nick}`);
      return data ? JSON.parse(data) : [];
    }

    function limparMarcacoes(nick) {
      sessionStorage.removeItem(`marcados_${nick}`);
      document.getElementById('audio-clear').play();
      renderCartela(gerarCartela(hashToSeed(nick)), nick);
    }

    function renderCartela(linhas, nick) {
      const container = document.getElementById('cartela-container');
      const tabela = document.createElement('table');
      tabela.className = "cartela-tabela";

      const marcados = new Set(carregarMarcacoes(nick));
      const novosMarcados = new Set(marcados);

      const audioSelect = document.getElementById('audio-select');
      const audioUnselect = document.getElementById('audio-unselect');

      linhas.forEach(linha => {
        const tr = document.createElement('tr');
        linha.forEach(evento => {
          const td = document.createElement('td');
          td.textContent = evento;

          if (marcados.has(evento)) {
            td.classList.add('marcado');
          }

          td.addEventListener('click', () => {
            td.classList.toggle('marcado');
            if (td.classList.contains('marcado')) {
              novosMarcados.add(evento);
              audioSelect.currentTime = 0;
              audioSelect.play();
            } else {
              novosMarcados.delete(evento);
              audioUnselect.currentTime = 0;
              audioUnselect.play();
            }
            salvarMarcacoes(nick, Array.from(novosMarcados));
          });

          tr.appendChild(td);
        });
        tabela.appendChild(tr);
      });

      container.innerHTML = '';
      container.appendChild(tabela);
    }

    const nick = getURLParam('nick');
    if (nick) {
      document.getElementById('nick-display').textContent = `Twitch: ${nick}`;
      const seed = hashToSeed(nick);
      const cartela = gerarCartela(seed);
      renderCartela(cartela, nick);

      const limparBtn = document.getElementById('limpar-btn');
      limparBtn.classList.remove('d-none');
      limparBtn.addEventListener('click', () => {
        limparMarcacoes(nick);
      });
    } else {
      document.getElementById('cartela-container').innerHTML = "<p class='text-danger'>Parâmetro 'nick' não fornecido na URL.</p>";
    }
  </script>

</body>
</html>
